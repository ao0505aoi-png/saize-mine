<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>1000å††ã‚¬ãƒãƒ£ï¼ˆå€‹äººç”¨ï¼‰</title>
<style>
  body { 
    font-family: sans-serif; 
    background: #ffffff; 
    padding: 20px;
    max-width: 800px;
    margin: 0 auto;
  }
  .btn { 
    padding: 20px 40px;
    background: #4CAF50; 
    color: #fff; 
    border: none; 
    border-radius: 8px; 
    cursor: pointer;
    font-size: 18px;
    font-weight: bold;
    margin: 10px 5px;
    transition: background 0.3s;
  }
  .btn:hover:not(:disabled) {
    background: #45a049;
  }
  .btn:disabled { 
    background: #aaa;
    cursor: not-allowed;
  }
  #gachaBtn {
    font-size: 24px;
    padding: 30px 60px;
  }
  #result { 
    margin-top: 20px; 
    padding: 20px; 
    border: 1px solid #ddd; 
    border-radius: 10px; 
    background: #fafafa;
    font-size: 16px;
  }
  h2 {
    color: #333;
  }
  ul {
    list-style: none;
    padding: 0;
  }
  li {
    padding: 8px 0;
    border-bottom: 1px solid #eee;
  }
</style>
</head>

<body>

<h2>ğŸ ã‚µã‚¤ã‚¼ãƒªãƒ¤1000å††ã‚¬ãƒãƒ£ï¼ˆå€‹äººç”¨ï¼‰</h2>

<p>â€»ãƒ‡ãƒ¼ã‚¿ã¯å›ºå®šã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆï¼ˆCSVï¼‰ã‹ã‚‰èª­ã¿è¾¼ã¿ã¾ã™ã€‚</p>

<button id="gachaBtn" class="btn" disabled>ğŸ° ã‚¬ãƒãƒ£ã‚’å›ã™</button>

<div id="result">ğŸ“¥ ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­...</div>


<script>
// -----------------------------
// â˜… å›ºå®šã™ã‚‹ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ URL
// -----------------------------
// â˜…â˜… ã“ã“ã‚’å¤‰æ›´ï¼šæœ«å°¾ã‚’ pub?output=csv ã« â˜…â˜…
const FIXED_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSKqsI81JSubHb3Sdh-9HVDe-cV9yHzlsfLt1fw8oH-zb-cVC1Dv8dcBsZLlQRc4KHtyHtqSmeJ8gjV/pub?output=csv";

let items = []; // å•†å“ãƒ‡ãƒ¼ã‚¿æ ¼ç´

// CSVã‚’èª­ã¿è¾¼ã‚“ã§itemsã«æ ¼ç´
function loadCSV() {
    fetch(FIXED_CSV_URL)
    .then(res => res.text())
    .then(text => {
        items = text.trim().split("\n").slice(1).map(line => {
            const [id, product_no, name, price, category] = line.split(",");
            return { 
                id: id?.trim() || "",
                product_no: product_no?.trim() || "",
                name: name?.trim() || "", 
                price: Number(price?.trim()) || 0, 
                category: category?.trim() || ""
            };
        });

        document.getElementById("result").innerHTML = `âœ… ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†ï¼(${items.length}ä»¶)`;
        document.getElementById("gachaBtn").disabled = false;
    })
    .catch(err => {
        document.getElementById("result").innerHTML = "âŒ èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ï¼šURLã‚’ç¢ºèªã—ã¦ãã ã•ã„";
        console.error(err);
    });
}


// -----------------------------
// â˜… ã¡ã‚‡ã†ã©1000å††ã«ãªã‚‹çµ„ã¿åˆã‚ã›ã‚’è¨ˆç®—
// -----------------------------
function findExact1000Combination() {
    const target = 1000;
    const n = items.length;
    let results = [];

    // å…¨ã¦ã®çµ„ã¿åˆã‚ã›ã‚’æ¢ç´¢ï¼ˆãƒ“ãƒƒãƒˆå…¨æ¢ç´¢ï¼‰
    for (let mask = 1; mask < (1 << n); mask++) {
        let sum = 0;
        let combo = [];

        for (let i = 0; i < n; i++) {
            if (mask & (1 << i)) {
                sum += items[i].price;
                combo.push(items[i]);
            }
        }

        if (sum === target) {
            results.push(combo);
        }
    }

    //ãƒ‘ã‚¿ãƒ¼ãƒ³ç¢ºèªç”¨ï¼ˆreturnã‚ˆã‚Šå‰ã«ç§»å‹•ï¼‰
    console.log(`å…¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ•°: ${n}`);
    console.log(`1000å††ã´ã£ãŸã‚Šã®çµ„ã¿åˆã‚ã›: ${results.length}ãƒ‘ã‚¿ãƒ¼ãƒ³`);
    
    // çµ„ã¿åˆã‚ã›ãŒãªã„å ´åˆ
    if (results.length === 0) return null;

    // ãƒ©ãƒ³ãƒ€ãƒ ã«1ã¤è¿”ã™
    return results[Math.floor(Math.random() * results.length)];
}


// -----------------------------
// ã‚¬ãƒãƒ£å®Ÿè¡Œ
// -----------------------------
function runGacha() {
    const combo = findExact1000Combination();

    if (!combo) {
        document.getElementById("result").innerHTML = 
            "âŒ 1000å††ã´ã£ãŸã‚Šã«ãªã‚‹çµ„ã¿åˆã‚ã›ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚<br>ï¼ˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¦‹ç›´ã—ã¦ãã ã•ã„ï¼‰";
        return;
    }

    let html = "<h3>ğŸ‰ ã‚¬ãƒãƒ£çµæœï¼ˆ1000å††ã´ã£ãŸã‚Šï¼‰</h3><ul>";
    let total = 0;

    combo.forEach(item => {
        html += `<li><strong>${item.product_no}</strong> ${item.name} <span style="color: #d32f2f;">${item.price}å††</span></li>`;
        total += item.price;
    });

    html += `</ul><p style="font-size: 20px; font-weight: bold; color: #4CAF50;">åˆè¨ˆ: ${total}å††</p>`;

    document.getElementById("result").innerHTML = html;
}


// â˜…â˜… ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•å®Ÿè¡Œ â˜…â˜…
window.addEventListener('DOMContentLoaded', function() {
    // ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
    document.getElementById("gachaBtn").onclick = runGacha;
    
    // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
    loadCSV();
});

</script>

</body>
</html>